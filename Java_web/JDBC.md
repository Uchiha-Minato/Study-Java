# JDBC

Java DataBase Connectivity - Java数据库连接

是Sun公司发布的一个数据库标准，定义了一套使用Java操作数据库的API 数据库厂商实现规范，即可使用JDBC操作本公司的数据库

- JDBC是Java EE规范的一种
- 使用JDBC可以执行SQL语句
- JDBC是使用Java与数据库通信的桥梁
- JDBC是众多ORM框架的基础：MyBatis、Hibemate等
- 开发JDBC程序需要使用 java.sql 与 javax.sql 中的API

JDBC可以做三件事：

    1.连接数据库
    2.发送SQL语句操作数据库
    3.获得返回的数据

## JDBC驱动

厂商提供的一个jar包，没有这个jar包则无法通过Java访问数据库

## JDBC核心接口

**1.Driver接口 - 用于注册驱动**

    package java.sql;
    public interface Driver
    The interface that every driver class must implement.
    //每个驱动类必须实现的接口。

例如mysql-connector-java-8.0.24.jar中，

实现类com.mysql.cj.jdbc.Driver:

    package com.mysql.cj.jdbc;
    public class Driver 
        extends NonRegisteringDriver
        implements java.sql.Driver {

        public Driver() throws SQLException {}

        static {
            try {
                DriverManager.registerDriver(new Driver());
            } catch (SQLException var1) {
                throw new RuntimeException("Can't register driver!");
            }
        }
    }

上述静态代码块就是在类初始化时将自身注册到系统中。

想要第三方厂商将驱动注册到JVM中，就必须实现Driver接口。

**2.Connection接口 - 用于连接数据库**

    package java.sql;
    public interface Connection
        extends Wrapper, AutoCloseable

相当于一个桥梁，在桥梁上运输着SQL语句。

**3.Statement接口 - 用于封装、发送SQL语句**

    package java.sql;
    public interface Statement
        extends Wrapper, AutoCloseable
    
    The object used for executing a static SQL statement and returning the results it produces.
    //Statement对象用于执行静态SQL语句并返回其产生的结果。

**可以使用通配符防止SQL注入的PreparedStatement是它的子接口。**

**4.ResultSet接口 - 封装返回的结果**

数据组织形式类似于二维表格。

    package java.sql;
    public interface ResultSet
        extends Wrapper, AutoCloseable
    
    A table of data representing a database result set, which is usually generated by executing a statement that queries the database.
    //表示数据库结果集的数据表，通常通过执行查询数据库的语句生成。

**5.PreparedStatement接口 - 速度更快，安全性更高**
    
    package java.sql;
    public interface PreparedStatement
        extends Statement
    
    An object that represents a precompiled SQL statement.
    //表示预编译SQL语句的对象。

SQL语句被预编译并存储在PSTMT对象中，然后可以使用此对象多次高效地执行该语句。

## 使用JDBC步骤

**1.创建Driver对象 - 加载驱动**

两种方式：

1.直接new一个Driver对象

    import com.mysql.cj.jdbc.Driver;
    Driver driver = new Driver();

2.使用Class.forName(String className)

    surround with try-catch
    Class.forName("com.mysql.cj.jdbc.Driver");
    
    public static Class<?> forName(String className) throws ClassNotFoundException
    参数:
    className——所需类的完全限定名。
    返回:
    为具有指定名称的类创建Class对象。

**2.创建Connection对象 - 建立连接**

对应第一步，两种方式：

1.使用Driver实现类的connect方法

    Connection conn = 
        driver.connect(String url, Properties info);

2.使用DriverManager.getConnection()静态方法

此方法有3种重载：

    (String url)
    (String url, String user, String password)
    (String url, Properties info)

    Connection conn = 
        DriverManager.getConnection(...);

*使用完毕的Connection一定要使用close关闭连接*

**3.创建Statement对象 - 插入记录**

使用Connection对象创建statement对象，即可使用stmt发送SQL语句操作数据库。

    Statement stmt = conn.createStatement();
    stmt.execute(String sql);
    stmt.close();
    conn.close();

注意，execute方法返回值是boolean，只用于提示执行是否成功。

如果使用PreparedStatement，可以使用通配符传入参数：

    String sql = "insert into user(username) values(?)";
    PreparedStatement pstmt 
       = conn.prepareStatement(sql);
    pstmt.setString(1, "lhy");
    pstmt.execute(sql);

**4.创建ResultSet对象 - 查询记录**

通过ResultSet来获取从数据库中查询得到的结果。

    String sql_query = "select * from user";
    PreparedStatement pstmt 
        = conn.prepareStatement(sql_query);
    ResultSet rs = pstmt.excuteQuery();
    while(rs.next()) {
        sout(rs.getString("username"));
    }
    rs.close();
    pstmt.close();
    conn.close();

**5.关闭连接**


